{
  "url": "https://habr.com/ru/articles/486716/comments/",
  "article_id": 486716,
  "title": "Что делает Free API Московской биржи в Google Таблицах",
  "comments": [
    {
      "id": 21227328,
      "author": "monah_tuk",
      "datetime": "2020-02-04T03:54:50.000Z",
      "text": "Гм, даже больше, я не знал (хотя и не интересовался в общем-то), что в таблицах гугла можно так ловко использовать API. Интересный способ погонять с визуализацией.Интересно подумать, как выгрузить статистику по стоимости инструмента на каждый день, пусть за последние 10 лет."
    },
    {
      "id": 21227350,
      "author": "empenoso",
      "datetime": "2020-02-04T04:11:12.000Z",
      "text": "Честно сказать именно выгрузкой истории я не интересовался, но такие пункты у них вроде есть."
    },
    {
      "id": 21231146,
      "author": "ibes",
      "datetime": "2020-02-04T19:06:19.000Z",
      "text": "Попробуйтеiss.moex.com/iss/history/engines/stock/markets/shares/boards/TQBR/securities/SBER.json?iss.json=extended&from=2000-01-01где SBER — тикер акции Сбербанк, TQBR — основной режим торгов. Цена закрытия на дату находится в поле CLOSE. Выборка ограничена 100 элементами, но можно запрашивать несколько раз, меняя from"
    },
    {
      "id": 21231788,
      "author": "monah_tuk",
      "datetime": "2020-02-04T22:37:43.000Z",
      "text": "Спасибо!"
    },
    {
      "id": 21228910,
      "author": "etovityusha",
      "datetime": "2020-02-04T10:42:08.000Z",
      "text": "Стоимость акций умеет импортировать встроенная функция GOOGLEFINANCE (пример: =GOOGLEFINANCE(«SBER»)). Разве что задержка может быть разной.А вот с облигациями и правда так гораздо удобней. Спасибо за статью."
    },
    {
      "id": 21228916,
      "author": "empenoso",
      "datetime": "2020-02-04T10:42:35.000Z",
      "text": "С облигациями да"
    },
    {
      "id": 21228912,
      "author": "melvin",
      "datetime": "2020-02-04T10:42:10.000Z",
      "text": "Спасибо большое за эту ссылку, может вы знаете где можно увидеть дивиденды по гдр (FIVE например)?"
    },
    {
      "id": 21228924,
      "author": "empenoso",
      "datetime": "2020-02-04T10:43:02.000Z",
      "text": "Все облигационные купоны есть сайте биржи, но в API их нет"
    },
    {
      "id": 21228930,
      "author": "empenoso",
      "datetime": "2020-02-04T10:44:06.000Z",
      "text": "Может бытьMoscow_Exchangeзнает ответ?"
    },
    {
      "id": 21231170,
      "author": "ibes",
      "datetime": "2020-02-04T19:14:15.000Z",
      "text": "Спасибо большое за эту ссылку, может вы знаете где можно увидеть дивиденды по гдр (FIVE например)?"
    },
    {
      "id": 21232032,
      "author": "empenoso",
      "datetime": "2020-02-05T04:18:58.000Z",
      "text": "Спасибо!"
    },
    {
      "id": 21279690,
      "author": "kostarev_v",
      "datetime": "2020-02-15T05:27:40.000Z",
      "text": "Удивительно, почему-то я не нашёл нигде информацию про запрос /dividends в API мосбиржи, где вы это узнали? У вас есть какой-то более полный справочник? Поделитесь!Есть ли подобное для истории купонов по облигациям?Есть ли подобное для истории амортизации облигаций?Пишу себе инструмент для автоматического расчёта портфеля, не хватает этих данных.PS. история дивидендов выдаётся не полная по некоторым акциям… По некоторым вообще не выдаётся… Странно. Мосбиржа не располагает информацией о том, что по акции выплачен дивиденд?"
    },
    {
      "id": 21279702,
      "author": "empenoso",
      "datetime": "2020-02-15T05:32:14.000Z",
      "text": "Поддерживаю. Здесь:https://www.moex.com/a2193https://iss.moex.com/iss/reference/Ни слова про этуhttp://iss.moex.com/iss/securities/TATN/dividends.xmlвозможность получать дивиденды."
    },
    {
      "id": 21279790,
      "author": "empenoso",
      "datetime": "2020-02-15T06:26:06.000Z",
      "text": "Подскажите, а инструмент для автоматического расчёта портфеля — на чем пишете?"
    },
    {
      "id": 21279828,
      "author": "kostarev_v",
      "datetime": "2020-02-15T06:49:50.000Z",
      "text": "на php, можете затестить (но только для мосбиржи пока)https://izi-invest.ru"
    },
    {
      "id": 21280646,
      "author": "empenoso",
      "datetime": "2020-02-15T11:08:29.000Z",
      "text": "А отчет от брокера чем парсите? Вы автоматически его обрабатываете или вручную?"
    },
    {
      "id": 21280672,
      "author": "kostarev_v",
      "datetime": "2020-02-15T11:14:52.000Z",
      "text": "автоматически… Отчёт брокера у quik сбера — это xls или html документ… не сложно парсится."
    },
    {
      "id": 21280850,
      "author": "empenoso",
      "datetime": "2020-02-15T12:06:40.000Z",
      "text": "Вот здесь человек построил свою отчетную таблицу только на парсинге отчетов брокера через сервисы Amazon:https://habr.com/ru/post/426027/А вот я делаю свою отчетную таблицу в гугл таблицах:https://vc.ru/finance/92990-upravlencheskiy-uchet-lichnyh-aktivov"
    },
    {
      "id": 21281342,
      "author": "kostarev_v",
      "datetime": "2020-02-15T15:17:26.000Z",
      "text": "Как говорится, хочешь сделать что то хорошо — сделай это сам…Я тоже свою систему писать начал, потому что готовые либо платные, либо не достаточно автоматизированы"
    },
    {
      "id": 22585870,
      "author": "iroln",
      "datetime": "2021-01-24T01:07:17.000Z",
      "text": "Там ещё проблема в том, что даны даты закрытия реестра (registryclosedate), но реальные даты отсечки (последний день торгов до выплаты дивов) нет. В режиме торгов акций T+ это минус 2 рабочих дня, но не всегда это так как оказалось. Например, для НЛМК была выплата дивов с датой закрытия реестра 09.01.2018, а дата отсечки по факту была 04.01.2018 (это видно на графике), хотя 9-2 рабочих дня — это 5 число, и биржа 5 числа работала, но отсечка была 4 числа. И как точно узнать дату отсечки не совсем понятно. Если считать всегда -2 рабочих дня без учёта локальных праздников и без учёта календаря торговых дней биржи, то можно неверно посчитать дивидендную доходность (попасть на дату с ценой после гэпа). Это важно при расчёте портфеля и анализе дивидендов. Они могли бы добавить в API информацию именно о дате отсечки с учётом режима торгов, наверняка она у них есть.Я тоже нигде не нашел в документации информации об этом endpoint-е в ISS. Возможно, оно экспериментальное или просто забыли добавить в доку.Смотреть дивиденды можно на сайте www.conomy.ru, например, для НЛМК:https://www.conomy.ru/emitent/nlmk/nlmk-divНо там тоже есть ошибки с датами отсечки и путаница с датами закрытия реестра (чего-то нет, что-то лишнее)Там ещё много разного фундаментального анализа есть для российских эмитентов."
    },
    {
      "id": 22586132,
      "author": "empenoso",
      "datetime": "2021-01-24T06:27:42.000Z",
      "text": "Спасибо за ваш комментарий!"
    },
    {
      "id": 22587486,
      "author": "iroln",
      "datetime": "2021-01-24T14:00:30.000Z",
      "text": "На всякий случай выложил в gist своё решение на Python для поиска рабочих дней биржи в стилеpandas.DateOffset:https://gist.github.com/espdev/135055b78cdad709025061b920578c5bРаботает так:>>> '2018-01-09' - TradingDay(calendar='XMOS', days=2)\nTimestamp('2018-01-04 00:00:00')Использует этот очень полезный пакет:https://github.com/quantopian/trading_calendars"
    },
    {
      "id": 22587952,
      "author": "empenoso",
      "datetime": "2021-01-24T15:59:28.000Z",
      "text": "Для Python к сожалению. Здесь ведь всё на JavaScript написано."
    },
    {
      "id": 22588148,
      "author": "iroln",
      "datetime": "2021-01-24T16:51:43.000Z",
      "text": "Возможно, для JavaScript тоже есть биржевые календари подобные trading_calendars. Как-то люди же узнают время и даты торговых сессий.trading_calendars хорош тем, что поддерживает практически все мировые биржи, но к сожалению, дальнейшая судьба проекта неизвестна, стартап quantopian прекратил своё существование.Было бы здорово, если бы ISS API Мосбиржи умел бы возвращать даты торгов. Вполне вероятно, что они это даже умеют, надо почитать документацию или спросить у них на форуме."
    },
    {
      "id": 22589570,
      "author": "empenoso",
      "datetime": "2021-01-25T06:20:23.000Z",
      "text": "Это хорошее предложение, ведь документация крайне ограничена, а возможностей много. Когда только разбирался что и как — в основном наугад шёл, но сейчас много упорядоченной информации правда не от из официальных источников."
    },
    {
      "id": 21279710,
      "author": "empenoso",
      "datetime": "2020-02-15T05:35:37.000Z",
      "text": "Может быть и по облигациям через API есть возможность получать значения какв этой табличке у них на сайте?Я из других мест получаю, но с API гораздо более удобный вариант бы был."
    },
    {
      "id": 21279738,
      "author": "kostarev_v",
      "datetime": "2020-02-15T05:57:34.000Z",
      "text": "Теоретически можно отсюда вычислить все даты и значения, но надо пробегаться по всему массивуhttp://iss.moex.com/iss/history/engines/stock/markets/bonds/boards/eqob/securities/RU000A0JU740?from=2016-01-01&interval=24&start=0"
    },
    {
      "id": 21279748,
      "author": "empenoso",
      "datetime": "2020-02-15T06:04:25.000Z",
      "text": "Но ведь даты выплаты купонадля корпоративной облигациикак будто не вижу?http://iss.moex.com/iss/history/engines/stock/markets/bonds/boards/eqob/securities/RU000A0JXQ85?from=2019-09-01&interval=24&start=0"
    },
    {
      "id": 21279824,
      "author": "kostarev_v",
      "datetime": "2020-02-15T06:47:40.000Z",
      "text": "Я так вычисляю даты выплаты купонов:Беру дату погашения MATDATE в секундах и вычитаю из неё период выплаты купона COUPONPERIOD в секундах. Каждый вычет — это дата выплаты купона. Получается с ошибкой (например если дата на выходные выпала...), но не значительной.//Дата погашения\n    $date = $bond['MATDATE'];\n    $time = strtotime($date);\n    //Период выплаты, сек.\n    $period = $bond['COUPONPERIOD'] * 3600 * 24;\n    //формируем список выплат по облигации от момента первой покупки\n    //$coupon_list = Array();\n    while ($time > $sd['time']) {\n        if ($time < time()) {\n            $summa = $bond['COUPONVALUE'] * $cnt * (1 - $nalog / 100);\n            $bond['summa'] = ceil($summa * 100) / 100;\n            $bond['date'] = date('d.m.y', $time);\n        }\n        $time -= $period;\n    }"
    },
    {
      "id": 21310044,
      "author": "kostarev_v",
      "datetime": "2020-02-22T11:58:28.000Z",
      "text": "Нашёл хороший способ для получения дат, купонов, амортизаций по облигациям.Пример запроса:https://iss.moex.com/iss/statistics/engines/stock/markets/bonds/bondization?from=2020-02-01&till=2020-02-20&start=0&limit=100&iss.only=amortizations,couponsВыдаёт все купоны по всем облигациям между указанными датами"
    },
    {
      "id": 21310078,
      "author": "empenoso",
      "datetime": "2020-02-22T12:04:50.000Z",
      "text": "А вот этого я не знал. Спасибо!"
    },
    {
      "id": 21310098,
      "author": "kostarev_v",
      "datetime": "2020-02-22T12:10:12.000Z",
      "text": "А вот по конкретной бумагеhttps://iss.moex.com/iss/statistics/engines/stock/markets/bonds/bondization/RU000A0JXU71"
    },
    {
      "id": 21779612,
      "author": "Viceroyalty",
      "datetime": "2020-06-26T10:12:07.000Z",
      "text": "Возможно я непроходимо глуп, но не могу понять по moex-овской PDF-ке как посмотреть индикативный курс Доллара США, используемый при расчете долларовых значений индексов через http запрос.Если я правильно понимаю по валюте инструменты не доступныiss.moex.com/iss/engines/stock/markets/currency"
    },
    {
      "id": 21779804,
      "author": "Viceroyalty",
      "datetime": "2020-06-26T10:55:29.000Z",
      "text": "Действительно, умом я тут не блеснул — курс используемый при расчете долларовых значений индексов недоступен, а вот обычные индикативные курсы — пожалуйстаiss.moex.com/iss/statistics/engines/futures/markets/indicativerates/securities"
    },
    {
      "id": 21782426,
      "author": "empenoso",
      "datetime": "2020-06-27T06:30:24.000Z",
      "text": "Похоже вы уже нашли ответ. Ещё можно в валютной секции посмотреть.Или через API Сбербанка:https://www.sberbank.ru/portalserver/proxy/?pipe=shortCachePipe&url=http://localhost/rates-web/rateService/rate/current%3FregionId%3D77%26currencyCode%3D840%26currencyCode%3D978%26rateCategory%3Dbeznal"
    },
    {
      "id": 22366408,
      "author": "catBasilio",
      "datetime": "2020-11-29T21:04:04.000Z",
      "text": "Вот, нашел по облигациям.https://iss.moex.com/iss/securities/RU000A0JXQ85/bondization.json?iss.json=extended&iss.meta=off&iss.only=coupons&lang=ru&limit=unlimitedВообще в chrome достаточно открыть консоль разработчика и посмотреть откуда сайт тянет запросы. Он сам по json эти данные выкачивает."
    },
    {
      "id": 23267432,
      "author": "Elis767",
      "datetime": "2021-07-16T12:48:35.000Z",
      "text": "Спасибо большое за эту ссылку, может вы знаете где можно увидеть дивиденды по гдр (FIVE например)?"
    },
    {
      "id": 23267768,
      "author": "empenoso",
      "datetime": "2021-07-16T14:24:28.000Z",
      "text": "В смысле по бумагам которых нет на Московской бирже?"
    },
    {
      "id": 23268996,
      "author": "Elis767",
      "datetime": "2021-07-17T06:20:18.000Z",
      "text": "В смысле по депозитарным распискам, торгуемым на Московской бирже. Если вот сюдаhttp://iss.moex.com/iss/securities/TATN/dividends.json?iss.json=extendedвместо татнефти(TATN) вставить пятерочку(FIVE), то ничего не покажет. Где можно посмотреть дивиденды пятёрочки?"
    },
    {
      "id": 23269012,
      "author": "empenoso",
      "datetime": "2021-07-17T06:42:26.000Z",
      "text": "Это же расписки - можно наhttps://finance.yahoo.com/quote/FIVE.ME/history?period1=1518393600&period2=1626480000&interval=div%7Csplit&filter=div&frequency=1d&includeAdjustedClose=trueнапример смотреть.Вотздесь писал как."
    },
    {
      "id": 23269522,
      "author": "Elis767",
      "datetime": "2021-07-17T12:18:20.000Z",
      "text": "Спасибо понятно, значит через moex API нельзя"
    },
    {
      "id": 21229860,
      "author": "nckma",
      "datetime": "2020-02-04T13:44:20.000Z",
      "text": "Я вот ищу такое ПО для учета, которое бы учитывало необходимый заплатить НДФЛ.Как это учитывать? Особенно если акции покупались в разное время по разным ценам."
    },
    {
      "id": 21232038,
      "author": "empenoso",
      "datetime": "2020-02-05T04:19:59.000Z",
      "text": "Это ведь работа брокера?"
    },
    {
      "id": 21232168,
      "author": "nckma",
      "datetime": "2020-02-05T05:38:30.000Z",
      "text": "Я понимаю, что брокер по итогу года рассчитает налог и возьмет его сам.Я про другое думаю. Вот я купил акцию по 100 рублей, потом по 120, потом по 130 рублей. Купленные акции складываются в фифо. Продажа акций осуществляется так же из фифо, то есть первыми продаются акции те, что по 100 рублей.Потом они начинают расти и опускаться, колебания курса.Я бы хотел продать подороже, а потом откупить их назад подешевле (спекуляция). Проблема в том, что продавая на пике я потом с трудом представляю по какой цене мне разумно откупать акцию назад.Может так оказаться, что продав на некотором пике и дождавшись снижения, откупая акцию назад я оказываюсь не в выигрыше, а в проигрыше из-за предполагаемого ндфл от первой продажи. Разве не так? Может оказаться, что продав дороже и потом купив чуть дешевле я не получаю ничего кроме проигрыша и уплаты налога. Понятно, что на самом деле расчет и уплата ведется по итогу года, а не по каждой сделке, но тем не менее… Это место у меня в голове не складывается. Опять же такое: акция сильно выросла в цене и я ее продал. Я посчитал какой получится ндфл и пытаюсь рассчитать по какой цене имеет смысл откупать с учетом тех 13% налога, но на такую большую величину акции уже не падают даже при больших колебаниях… Как быть?Возможно, расмышляя в таком ключе, я действую не верно. Некоторые говорят, что не нужно об этом думать вообще: купил-продал — остался в выигрыше, забудь об этой сделке, думай о следующей. Но вот мне это не дает покоя — как правильно? Мне кажется нужно ПО для учета фифо сделок и расчета ндфл по каждой сделке… Сейчас я пытаюсь это сделать в экселе, но получается не очень…"
    },
    {
      "id": 21232382,
      "author": "empenoso",
      "datetime": "2020-02-05T06:44:07.000Z",
      "text": "Понял о чём Вы, но я как долгосрочный инвестор такими вещами не интересовался — лично у меня нет решения."
    },
    {
      "id": 21232542,
      "author": "nckma",
      "datetime": "2020-02-05T07:19:21.000Z",
      "text": "Долгосрочный инвестор — дело хорошее, но думаю его это тоже касается…Например, вы ставите стопы на продажу?Когда акция подросла вы же передвигаете наверное стоп на продажу повыше, так?И если акция внезапно провалилась и по стопу была автоматически продана, чтобы зафиксировать прибыль и избежать убытков, вы потом хотите ее назад откупить или нет?"
    },
    {
      "id": 21233112,
      "author": "empenoso",
      "datetime": "2020-02-05T08:54:22.000Z",
      "text": "Раньше (давно) занимался трейдингом и торговыми системами, но сейчас уже много лет нет. Дело не особо благодарное — время тратится, результат не гарантирован."
    },
    {
      "id": 21233136,
      "author": "empenoso",
      "datetime": "2020-02-05T08:58:31.000Z",
      "text": "Вот кстатихорошая иллюстрация на гитхабе:"
    },
    {
      "id": 21305308,
      "author": "sunwayru",
      "datetime": "2020-02-21T03:35:10.000Z",
      "text": "По ссылкеiss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities.xml?iss.meta=off&iss.only=securities&securities.columns=SECID,PREVADMITTEDQUOTE же выдаются данные на конец предыдущего торгового дня. А есть ссылка для получения актуальных данных? Пусть с 15мин задержкой."
    },
    {
      "id": 21305312,
      "author": "empenoso",
      "datetime": "2020-02-21T03:36:59.000Z",
      "text": "Измените PREVADMITTEDQUOTE на другое:\"BOARDID\": {\"type\": \"string\", \"bytes\": 12, \"max_size\": 0},\n\"SHORTNAME\": {\"type\": \"string\", \"bytes\": 30, \"max_size\": 0},\n\"PREVPRICE\": {\"type\": \"double\"},\n\"LOTSIZE\": {\"type\": \"int32\"},\n\"FACEVALUE\": {\"type\": \"double\"},\n\"STATUS\": {\"type\": \"string\", \"bytes\": 3, \"max_size\": 0},\n\"BOARDNAME\": {\"type\": \"string\", \"bytes\": 381, \"max_size\": 0},\n\"DECIMALS\": {\"type\": \"int32\"},\n\"SECNAME\": {\"type\": \"string\", \"bytes\": 90, \"max_size\": 0},\n\"REMARKS\": {\"type\": \"string\", \"bytes\": 24, \"max_size\": 0},\n\"MARKETCODE\": {\"type\": \"string\", \"bytes\": 12, \"max_size\": 0},\n\"INSTRID\": {\"type\": \"string\", \"bytes\": 12, \"max_size\": 0},\n\"SECTORID\": {\"type\": \"string\", \"bytes\": 12, \"max_size\": 0},\n\"MINSTEP\": {\"type\": \"double\"},\n\"PREVWAPRICE\": {\"type\": \"double\"},\n\"FACEUNIT\": {\"type\": \"string\", \"bytes\": 12, \"max_size\": 0},\n\"PREVDATE\": {\"type\": \"date\", \"bytes\": 10, \"max_size\": 0},\n\"ISSUESIZE\": {\"type\": \"int64\"},\n\"ISIN\": {\"type\": \"string\", \"bytes\": 36, \"max_size\": 0},\n\"LATNAME\": {\"type\": \"string\", \"bytes\": 90, \"max_size\": 0},\n\"REGNUMBER\": {\"type\": \"string\", \"bytes\": 90, \"max_size\": 0},\n\"PREVLEGALCLOSEPRICE\": {\"type\": \"double\"},\n\"PREVADMITTEDQUOTE\": {\"type\": \"double\"},\n\"CURRENCYID\": {\"type\": \"string\", \"bytes\": 12, \"max_size\": 0},\n\"SECTYPE\": {\"type\": \"string\", \"bytes\": 3, \"max_size\": 0},\n\"LISTLEVEL\": {\"type\": \"int32\"},\n\"SETTLEDATE\": {\"type\": \"date\", \"bytes\": 10, \"max_size\": 0}```"
    },
    {
      "id": 21305586,
      "author": "sunwayru",
      "datetime": "2020-02-21T06:21:16.000Z",
      "text": "все доступные поля со значениями можно же увидеть поiss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities.xml?iss.meta=off&iss.only=securitiesи тут нет текущей котировки (пусть с 15мин задержкой)<row SECID=\"AFKS\" BOARDID=\"TQBR\" SHORTNAME=\"Система ао\" PREVPRICE=\"18.7\" LOTSIZE=\"100\" FACEVALUE=\"0.09\" STATUS=\"A\" BOARDNAME=\"Т+: Акции и ДР - безадрес.\" DECIMALS=\"3\" SECNAME=\"АФК \"Система\" ПАО ао\" REMARKS=\"\" MARKETCODE=\"FNDT\" INSTRID=\"EQIN\" SECTORID=\"EQ-N\" MINSTEP=\"0.001\" PREVWAPRICE=\"18.372\" FACEUNIT=\"SUR\" PREVDATE=\"2020-02-19\" ISSUESIZE=\"9650000000\" ISIN=\"RU000A0DQZE3\" LATNAME=\"AFK Sistema\" REGNUMBER=\"1-05-01669-A\" PREVLEGALCLOSEPRICE=\"18.7\" PREVADMITTEDQUOTE=\"18.7\" CURRENCYID=\"SUR\" SECTYPE=\"1\" LISTLEVEL=\"1\" SETTLEDATE=\"2020-02-25\"/>а только котировка на конец предыдущего торгового дня…"
    },
    {
      "id": 21305634,
      "author": "empenoso",
      "datetime": "2020-02-21T06:38:16.000Z",
      "text": "в другом разделе тогда посмотрите — у них достаточно запутанная структура API и текущая цена точно есть"
    },
    {
      "id": 21306304,
      "author": "empenoso",
      "datetime": "2020-02-21T08:37:13.000Z",
      "text": "https://iss.moex.com/iss/engines/stock/markets/shares/раздел marketdata вместо securities"
    },
    {
      "id": 21307300,
      "author": "sunwayru",
      "datetime": "2020-02-21T12:15:05.000Z",
      "text": "О, спасибо тебе, добрый человек! Не хватает репутации, чтобы поставить + тебе.Итак, для получения цены BID (лучшая котировка на покупку для оценки портфеля) для тикера, например, из ячейки C3, вместо кривой формулы:=GOOGLEFINANCE(\"MCX:\" & C3)которая не работает с привелигированными акциями, ещё и округляет дробные значения (у ФСК, ТГК-1 и др.) до бесполезных значений, используем такую формулу:=SUBSTITUTE( IMPORTxml(\"https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities.xml?iss.meta=off&iss.only=marketdata&marketdata.columns=SECID,BID\"; \"//row[@SECID='\" & C3 & \"']/@BID\") ;\".\";\",\")а в ваших примерах вместо CONCATENATE проще использовать &"
    },
    {
      "id": 21308406,
      "author": "empenoso",
      "datetime": "2020-02-21T16:48:41.000Z",
      "text": "Хорошо, спасибо!"
    },
    {
      "id": 21309648,
      "author": "sunwayru",
      "datetime": "2020-02-22T09:25:19.000Z",
      "text": "И ещё один способ как получить цену последней сделки, напр. для AFKS=IMPORTXML(\"https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities/AFKS.xml?iss.meta=off&iss.only=marketdata&marketdata.columns=LAST\"; \"//@LAST\")это вариант для русской локали, а для американской вместо последей \";\" ставим \",\""
    },
    {
      "id": 21309666,
      "author": "sunwayru",
      "datetime": "2020-02-22T09:33:45.000Z",
      "text": "тут вместо цены BID лучше использовать LAST. А то в выходные BID пустой, а цена последней сделки всегда непустая"
    },
    {
      "id": 21309658,
      "author": "sunwayru",
      "datetime": "2020-02-22T09:29:28.000Z",
      "text": "Ещё один способ, это на отедльном листе загрузить все котировки, например, цены последних сделкок:=IMPORTHTML(\"http://iss.moex.com/iss/engines/stock/markets/shares/boards/tqbr/securities.html?iss.meta=on&iss.only=marketdata&marketdata.columns=SECID,LAST\"; \"table\";1)А потом на другом листе с помощью VLOOKUP находить по тикеру соответствующую цену.И можно добавить макрос, который перезаписывает формулу, чтобы принудительно обновить котировки:function CopyPaste() {\nvar spreadsheet = SpreadsheetApp.getActive();\nvar startsheet = spreadsheet.getActiveSheet();\nspreadsheet.setActiveSheet(spreadsheet.getSheetByName('TICK'), true);\nspreadsheet.getRange('E1').activate();\nspreadsheet.getActiveRangeList().clear({contentsOnly: true, skipFilteredRows: true});\nUtilities.sleep(1000);\nspreadsheet.getCurrentCell().setFormula('=IMPORTHTML(\"http://iss.moex.com/iss/engines/stock/markets/shares/boards/tqbr/securities.html?iss.meta=on&iss.only=marketdata&marketdata.columns=SECID,LAST\"; \"table\";1)');\nspreadsheet.setActiveSheet(startsheet);\nspreadsheet.getRange('A16').activate();\n};"
    },
    {
      "id": 21309774,
      "author": "empenoso",
      "datetime": "2020-02-22T10:04:20.000Z",
      "text": "Спасибо"
    },
    {
      "id": 21508936,
      "author": "Johnem",
      "datetime": "2020-04-17T07:10:43.000Z",
      "text": "Не знаете как это провернуть в Excel, и почему все работают в Гугл доках...?"
    },
    {
      "id": 21508940,
      "author": "empenoso",
      "datetime": "2020-04-17T07:11:13.000Z",
      "text": "Для Excel надо писать VBA скрипт чтобы было подобное."
    },
    {
      "id": 21509402,
      "author": "empenoso",
      "datetime": "2020-04-17T09:15:57.000Z",
      "text": "Для Excel всё же есть вариант. Например, стоимость еврооблигации RUS-28:=ФИЛЬТР.XML(ВЕБСЛУЖБА(\"http://iss.moex.com/iss/engines/stock/markets/bonds/boards/TQOD/securities/XS0088543193/securities.xml\");\"//document//data//rows//row/@PREVPRICE\")Отсюда:https://journal.tinkoff.ru/investment-report/"
    },
    {
      "id": 21522450,
      "author": "empenoso",
      "datetime": "2020-04-21T10:02:25.000Z",
      "text": "Продолжение истории, теперь и для локального использования:Free API Мосбиржи в формулах Microsoft Excel"
    },
    {
      "id": 21618882,
      "author": "yuppie",
      "datetime": "2020-05-14T22:22:45.000Z",
      "text": "Никак не могу понять — как можно например получить последнюю цену акций Сбера?"
    },
    {
      "id": 21619072,
      "author": "empenoso",
      "datetime": "2020-05-15T01:40:30.000Z",
      "text": "Используйте LAST."
    },
    {
      "id": 21620882,
      "author": "yuppie",
      "datetime": "2020-05-15T11:54:53.000Z",
      "text": "Я долго не мог понять вообще — какой запрос посылать, такой:iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities/SBER.jsonили есть более информативные запросы? Это самый лучший который, я смог собрать…"
    },
    {
      "id": 21621412,
      "author": "empenoso",
      "datetime": "2020-05-15T13:59:16.000Z",
      "text": "Можно и по вашей ссылке:https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities/SBER.json?iss.meta=off&iss.only=marketdata&marketdata.columns=SECID,LAST"
    },
    {
      "id": 21621804,
      "author": "empenoso",
      "datetime": "2020-05-15T15:33:31.000Z",
      "text": "Или дажеhttps://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities/SBER?iss.meta=off&iss.only=marketdata&marketdata.columns=LAST"
    },
    {
      "id": 21797488,
      "author": "xkrt",
      "datetime": "2020-07-01T07:45:44.000Z",
      "text": "Подскажите, как можно получить капитализацию компании?"
    },
    {
      "id": 21797740,
      "author": "empenoso",
      "datetime": "2020-07-01T09:09:48.000Z",
      "text": "Ищите источник данных или сайт, который публикует эту информацию.Может быть вяху финанс есть."
    },
    {
      "id": 21887746,
      "author": "akhmadullin",
      "datetime": "2020-07-25T22:10:56.000Z",
      "text": "Подскажите, а вы пользуетесь мультипликатором Р/Е и другими? Если да, то как загружаете в свой файл (я так понял вы используете Google Sheets)? Я пытаюсь сейчас отдельно вытянуть из московской биржи капитализацию и чистую прибыль за последние 12 месяцев, но как-то сложно идет)"
    },
    {
      "id": 21887932,
      "author": "empenoso",
      "datetime": "2020-07-26T02:12:54.000Z",
      "text": "Для этого я использую api отhttps://financialmodelingprep.com, но не уверен что там есть Россия."
    },
    {
      "id": 21890722,
      "author": "akhmadullin",
      "datetime": "2020-07-26T19:12:23.000Z",
      "text": "по американскому рынку прекрасно тянется из гуглдоксов и яху.финанс, а вот как для российского рынка это делать, ума не приложу. Нашел, как с биржи МОЕХ тянуть количество акций в обращении, потом просто перемножаю кол-во акций на их стоимость и получаю капитализацию. А вот с Р/Е осталось вытянуть годовую прибыль за последние 4 квартала. Пока не понял как это делается."
    },
    {
      "id": 23394888,
      "author": "Shrike",
      "datetime": "2021-08-21T02:07:12.000Z",
      "text": "Ссылка из вашего спредшита для некоторых ETF не работает, к сожалению. Например,  TSPX (Tinkoff S&P500). Он вроде находится, но никаких данных о ценах нет (rows пустые):https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities/TSPX.xmlВ тут (эндпоинт на котором основана формула в спредшите) его вообще нет -https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQTF/securities.xml?iss.meta=off&iss.only=securitiesВ чем может быть дело?"
    },
    {
      "id": 23396614,
      "author": "Anrikigai",
      "datetime": "2021-08-21T14:18:22.000Z",
      "text": "На знаю, где спросить, вдруг здесь помогут :)Чтобы собрать портфель из ETF, хочу знать их структуру. На каком-нибудь FinEx полно графиков с долями стран, секторов в процентах и т.п. Но как бы это все вытащить пусть не сразу в таблицу, а через несложные скрипты на python?На MOEX такой детальной инфы по составу фондов не нашел..."
    },
    {
      "id": 23396982,
      "author": "empenoso",
      "datetime": "2021-08-21T16:38:15.000Z",
      "text": "Вопрос очень хороший, но Московская биржа таких данных не предоставляет. Нет ни на сайте,  ни в API их."
    },
    {
      "id": 26353250,
      "author": "red-cat-fat",
      "datetime": "2024-01-08T16:06:44.000Z",
      "text": "У вас доступ к таблицам-примерам закрыт("
    },
    {
      "id": 26480178,
      "author": "b00",
      "datetime": "2024-02-08T16:14:00.000Z",
      "text": "Тоже стукнулся в закрытый доступ - да и сделал в LO Calc в итоге, что хотел. Функции там есть готовые, например:Название (строка):=FILTERXML(WEBSERVICE(CONCATENATE(\"https://iss.moex.com/iss/engines/stock/markets/bonds/boards/\";$L5;\"/securities.xml?iss.meta=off&iss.only=securities\"));CONCATENATE(\"//row[@SECID=\"\"\";$A5;\"\"\"]/@SECNAME\"))Величина купона (дробное):=NUMBERVALUE(FILTERXML(WEBSERVICE(CONCATENATE(\"https://iss.moex.com/iss/engines/stock/markets/bonds/boards/\";$L5;\"/securities.xml?iss.meta=off&iss.only=securities\"));CONCATENATE(\"//row[@SECID=\"\"\";$A5;\"\"\"]/@COUPONVALUE\"));\".\")A5 = ISINL5 = режим торгов (TQCB и прочие)"
    },
    {
      "id": 28531130,
      "author": "Stan_1",
      "datetime": "2025-07-05T08:33:01.000Z",
      "text": "Интересно, вижу на скрине \"Бумаги для квалифицированных инвесторов\". А какой признак в API MOEX об этом говорит? Не могу найти :("
    }
  ]
}