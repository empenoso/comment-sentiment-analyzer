{
  "url": "https://habr.com/ru/articles/498268/comments/",
  "article_id": 498268,
  "title": "Free API Мосбиржи в формулах Microsoft Excel",
  "comments": [
    {
      "id": 21524420,
      "author": "empenoso",
      "datetime": "2020-04-21T17:38:02.000Z",
      "text": "Предыдущие комментарии:https://habr.com/ru/post/486716/#comment_21227328"
    },
    {
      "id": 21524624,
      "author": "kernelconf",
      "datetime": "2020-04-21T18:27:10.000Z",
      "text": "Скажите, Вы не видели в API что-нибудь чтобы хоть как-то связать инструменты срочного рынка с базовыми активами, если они торгуются на Мосбирже? В Квике в таблице «Текущие торги» есть «Базовый актив», но он совсем не совпадает с реальными тикерами. Такое впечатление, что на FORTS своя собственная база, впрочем, это и логично, так как базовым активом может быть что угодно.Контанго-бэквордацию хочу считать."
    },
    {
      "id": 21525524,
      "author": "empenoso",
      "datetime": "2020-04-22T02:55:44.000Z",
      "text": "Хороший вопрос, но немного не по теме статьи похоже."
    },
    {
      "id": 21525532,
      "author": "empenoso",
      "datetime": "2020-04-22T03:01:40.000Z",
      "text": "В API есть секция срочного рынка.Если Вы хотите делать подобные расчёты, то надо брать цены из разных секций.Контанго называется превышение цены дальних фьючерсов над ближним, бэквордация — наоборот. Считается, что бычьей фазой рынка является состояние бэквордации, а медвежьей — контанго."
    },
    {
      "id": 21525848,
      "author": "Sonnenwendekind",
      "datetime": "2020-04-22T06:15:01.000Z",
      "text": "QUIK — программа для суровых профи, они пользуютсякороткими кодами"
    },
    {
      "id": 21525912,
      "author": "empenoso",
      "datetime": "2020-04-22T06:39:20.000Z",
      "text": "QUIK это нечто. Как 10 лет назад так и сейчас не особо поменялся."
    },
    {
      "id": 21525998,
      "author": "Sonnenwendekind",
      "datetime": "2020-04-22T07:06:37.000Z",
      "text": "Вы на Bloomberg Terminal гляньте ;) С другой стороны, всякие свистелки в профессиональном софте ни к чему."
    },
    {
      "id": 21526012,
      "author": "empenoso",
      "datetime": "2020-04-22T07:11:43.000Z",
      "text": "Слишком дорогой для частного лица :("
    },
    {
      "id": 21525914,
      "author": "empenoso",
      "datetime": "2020-04-22T06:39:52.000Z",
      "text": "У брокеров удобные мобильные приложения почти у всех появились."
    },
    {
      "id": 21528480,
      "author": "kostarev_v",
      "datetime": "2020-04-22T14:28:06.000Z",
      "text": "Добавлю инфы:Если в запросе к API убрать расширение .xml, то результат выдаст в удобочитаемом html. Так же поддерживаются форматы .json и .csvДивиденды мосбиржа выдаёт не все. Например по МРСК Урала история дивидендов у них пустая. По каким-то бумагам вроде не полная.3.В истории купонов и амортизаций не верно выдаёт значения номинала бумаги на определенную дату (FACEVALUE), во всех строках почему-то стоит текущее значение, а не то которое было на указанную дату.Короче говоря API у мосбиржи очень крутое, но как будто сырое."
    },
    {
      "id": 21528496,
      "author": "empenoso",
      "datetime": "2020-04-22T14:30:20.000Z",
      "text": "Хорошее дополнение"
    },
    {
      "id": 21528506,
      "author": "empenoso",
      "datetime": "2020-04-22T14:31:12.000Z",
      "text": "Короче говоря API у мосбиржи очень крутое, но как будто сырое.Но оно хотя бы без смс и регистрации доступно."
    },
    {
      "id": 21528990,
      "author": "empenoso",
      "datetime": "2020-04-22T16:00:36.000Z",
      "text": "А вот кстати мне на каналеt.me/RationalAnswer_Chatчто ответили на счёт FACEVALUE:Тут дело вот в чём. Если не фильтровать узлы, то замечал ли, что там есть узел securities, узел marketdata и ещё какие-то?Так вот, securities — это _статические_ данные они неизменны в течение дня. (Чтоб их было достаточно один раз выкачать, а потом не указывать в последующих запросах.)Если нужны какие-то динамические данные: текущая цена, исторические данные, etc. то они точно не будут в узле securities. То есть надо смотреть аналог колонки FACEVALUE в других узлах (history, или как он там, не помню точно).Поэтому, скажем, «стабильная» цена PREVADMITTEDQUOTE находится в securities, а «переменная» цена LCURRENTPRICE в marketdata, например:https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQTF/securities.json?iss.meta=off&iss.only=marketdata,securities&marketdata.columns=SECID,LCURRENTPRICE&securities.columns=SECID,PREVADMITTEDQUOTE,FACEVALUE&securities=FXRL"
    },
    {
      "id": 21529020,
      "author": "empenoso",
      "datetime": "2020-04-22T16:04:15.000Z",
      "text": "Просто я пользуюсь history для получения facevalue по ОФЗ-ИН и там вроде как всё работалоДа, я и говорю, нужно взять FACEVALUE из history, не из securities.https://iss.moex.com/iss/history/engines/stock/markets/bonds/boards/TQOB/securities/SU52001RMFS3?history.columns=TRADEDATE,FACEVALUE&from=2020-01-10"
    },
    {
      "id": 21529242,
      "author": "kostarev_v",
      "datetime": "2020-04-22T16:53:15.000Z",
      "text": "Да, по этой ссылке выдаёт верную информацию.Я пользовался вот этойhttps://iss.moex.com/iss/statistics/engines/stock/markets/bonds/bondization/RU000A0JVSY3для получения купонов и амортизаций и от туда же FACEVALUE тянул… Вот там оно всегда текущее, не смотря на даты."
    },
    {
      "id": 21529092,
      "author": "kostarev_v",
      "datetime": "2020-04-22T16:18:43.000Z",
      "text": "Мне из всего этого больше всего интересен вывод текущей цены в ExcelЧто мне не понятно или смущает:Почему-то цена не обновляется автоматически. Как её обновить?Очень сложная и не универсальная формула… Т.е. надо для каждой бумаги вручную узнать её board_id и подставить в запрос.Думаю можно сделать как-то универсальней. Например получать цену не по этой ссылкеhttps://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities?iss.dp=comma&iss.meta=off&iss.only=securities&securities.columns=SECID,PREVADMITTEDQUOTEгде выдаются цены всех бумаг на доске TQBR, а по этойhttps://iss.moex.com/iss/engines/stock/markets/shares/securities/SBER/?iss.only=marketdata&marketdata.columns=SECID,BOARDID,LASTгде выдаются цены по конкретной бумаге. Подразумеваем, что тикер SECID нам известен, осталось только выбрать данные по нужной нам доске TQBR. Это наверное тоже можно автоматизировать.Через запросhttps://iss.moex.com/iss/securities/SBER?iss.only=boards&boards.columns=secid,boardid,is_primaryвыбрать все доски бумаги, и из полученного списка получить ту, у которой is_primary = 1Либо как в посте через ссылкуhttps://iss.moex.com/iss/securities?q=sber&iss.meta=off&securities.columns=secid,primary_boardidПолучить все бумаги по запросу q= и выбрать из результата ту, у которой SECID совпадает с нашим. Так или иначе мы можем получить primary_board_id и записать его в промежуточную ячейку, а потом уже из неё наверное можно взять значение, что бы отфильтровать предыдущую выборку с ценами.Я не разбираюсь в формулах Excel, но мне кажется это возможно сделать…Если в формулу ВЕБСЛУЖБА забивать не заранее подготовленный адрес, а сформированный из значений ячеек."
    },
    {
      "id": 21529156,
      "author": "kostarev_v",
      "datetime": "2020-04-22T16:34:35.000Z",
      "text": "Всё, нашёл решение:В ячейку А1 записываем тикер бумаги (например SBER)Во второй столбец записываем BOARDID. Просто вставляем формулу=ПОДСТАВИТЬ(ФИЛЬТР.XML(ВЕБСЛУЖБА(\"https://iss.moex.com/iss/securities/\"&A1&\".xml?iss.meta=off&iss.only=boards&boards.columns=secid,boardid,is_primary\");\"//document//data//rows//row[@is_primary=1]/@boardid\");\".\";\",\")В третий столбец пишем цену, просто вставляем формулу=ПОДСТАВИТЬ(ФИЛЬТР.XML(ВЕБСЛУЖБА(\"https://iss.moex.com/iss/engines/stock/markets/shares/securities/\"&A22&\".xml?iss.meta=off&iss.only=marketdata&marketdata.columns=SECID,BOARDID,LAST\");\"//document//data//rows//row[@BOARDID='\"&B1&\"']/@LAST\");\".\";\",\")Дальше просто протягиваем эти формулы вниз по всем тикерам и получаем все цены.Я молодец, и ты молодец… мы молодцы.Вопрос с обновлением цены при открытии файла для меня остаётся открытым."
    },
    {
      "id": 21529160,
      "author": "kostarev_v",
      "datetime": "2020-04-22T16:35:38.000Z",
      "text": "ошибка во второй формуле вместо A22 должно A1 быть."
    },
    {
      "id": 21531812,
      "author": "empenoso",
      "datetime": "2020-04-23T09:54:12.000Z",
      "text": "Перезаписал файл «API Мосбиржи в Microsoft Excel.xlsx» вместе с Вашим решением."
    },
    {
      "id": 21531846,
      "author": "kostarev_v",
      "datetime": "2020-04-23T10:01:45.000Z",
      "text": "Клёво, только с облигациями это не сработает, формулу редактировать придётся.Вместо shares ставить bonds во второй формуле… При желании конечно и это можно автоматизировать."
    },
    {
      "id": 21581450,
      "author": "krllp",
      "datetime": "2020-05-06T12:46:07.000Z",
      "text": "Может кому пригодится, еще есть вариант использовать вместо:https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities.xml?iss.dp=comma&iss.meta=off&iss.only=securities&securities.columns=SECID,PREVADMITTEDQUOTEтакой вариант:https://iss.moex.com/iss/engines/stock/markets/shares/boardgroups/57/securities.xml?iss.dp=comma&iss.meta=off&iss.only=securities&securities.columns=SECID,PREVADMITTEDQUOTEВ первом варианте необходимо по каждому борду проверять, а во втором по группе бордов. Группа 57 объединяет весь основной режим Т+, скорее всего там будут все нужные вам акции и одним запросом, точно также, думаю и для облигаций можно"
    },
    {
      "id": 21581458,
      "author": "empenoso",
      "datetime": "2020-05-06T12:47:02.000Z",
      "text": "Спасибо! Интересно."
    },
    {
      "id": 21581486,
      "author": "empenoso",
      "datetime": "2020-05-06T12:51:47.000Z",
      "text": "Группа 57 объединяет весь основной режим Т+, скорее всего там будут все нужные вам акции и одним запросом, точно также, думаю и для облигаций можноНо для облигаций это не работает или ссылка должна быть другая:https://iss.moex.com/iss/engines/stock/markets/bonds/boardgroups/57/securities.xml?iss.dp=comma&iss.meta=off&iss.only=securities&securities.columns=SECID,PREVADMITTEDQUOTEВ общем виде ведь ссылкаhttps://iss.moex.com/iss/engines/stock/markets/${markets}/boards/${boardID}/securities.json?iss.meta=off&iss.only=${section}&${section}.columns=${columns}"
    },
    {
      "id": 21582238,
      "author": "krllp",
      "datetime": "2020-05-06T16:10:34.000Z",
      "text": "Да, покопался тоже, с облигациями чуть сложнее, как я понял основные группы по облигациям две(T0 и T+ основных режимов), их id: 7 и 58, соответственно ссылки:https://iss.moex.com/iss/engines/stock/markets/bonds/boardgroups/7/securities.xml?iss.dp=comma&iss.meta=off&iss.only=securities&securities.columns=SECID,PREVADMITTEDQUOTEhttps://iss.moex.com/iss/engines/stock/markets/bonds/boardgroups/58/securities.xml?iss.dp=comma&iss.meta=off&iss.only=securities&securities.columns=SECID,PREVADMITTEDQUOTE"
    },
    {
      "id": 21582466,
      "author": "empenoso",
      "datetime": "2020-05-06T17:08:31.000Z",
      "text": "Спасибо, это ценная информация."
    },
    {
      "id": 21792286,
      "author": "olegpoltoraname",
      "datetime": "2020-06-29T22:18:55.000Z",
      "text": "Ваша ссылка показывает ту сумму, которую отображает сбербанк-инвестиции.Но как ее подключить в экселе? Ведь там уже идет не xml и нужен другой обвес…"
    },
    {
      "id": 21792544,
      "author": "empenoso",
      "datetime": "2020-06-30T03:10:15.000Z",
      "text": "В Экселе если не xml на самом деле не очень. Просто кроме него возможны и другие варианты."
    },
    {
      "id": 21792620,
      "author": "kostarev_v",
      "datetime": "2020-06-30T03:55:18.000Z",
      "text": "В адресную строку добавь .xml и выдаст в .xml"
    },
    {
      "id": 21531074,
      "author": "kostarev_v",
      "datetime": "2020-04-23T07:30:59.000Z",
      "text": "Нашёл отноительно простой способ обновления данных в формулах ВЕБСЛУЖБА(CTRL+ ALT + F9)Думаю можно добавить эту комбинацию в виде подсказки на листах"
    },
    {
      "id": 21531820,
      "author": "empenoso",
      "datetime": "2020-04-23T09:54:32.000Z",
      "text": "Перезаписал файл «API Мосбиржи в Microsoft Excel.xlsx»."
    },
    {
      "id": 21532518,
      "author": "kostarev_v",
      "datetime": "2020-04-23T12:14:47.000Z",
      "text": "Настроил эту фишку у себя на сайте при экспорте в Excel. Теперь портфель в excel можно импортировать с этими формулами внутри. Кто хочет — затестите:https://izi-invest.ru/10ссылка — Экспорт в Excel [Auto]"
    },
    {
      "id": 21537406,
      "author": "kostarev_v",
      "datetime": "2020-04-24T13:40:49.000Z",
      "text": "Столкнулся с этой же проблемой и выяснил, что это результат неправильной интерепретации функцией ФИЛЬТР.XML значения как... даты.Возьмем пример значения7.95.Если просто ввести это число в ячейку Excel, то в ячейке появится текстиюл.95, а в поле редактирования будет стоять01.07.1995. Это потому, что в Excel сработал механизм автоматического \"угадывания\" формата значения, и он решил, что пользователь ввёл дату.Теперь, если поменять формат ячейки на \"Общий\" (там сначала будет стоять(все форматы)), то в поле появится... целое число34881.Именно это происходит в функции ФИЛЬТР.XML для некоторых котировок (т.е. когда сервис MOEX возвращает, например,LAST=\"7.95\"). Функция возвращает неправильно интерпретируемое значение уже в общем формате, как целое число.К сожалению, с этим целочисленным результатом ничего не получится сделать, изменение формата ячейки не помогает. Как заставить саму функцию ФИЛЬТР.XMLНЕинтерпретировать подобные значения как даты, я пока так не нашёл. Временно прикрутил \"костыль\", похожий на предложенный вами - заменяю точки на запятые в исходном xml-респонсе, безопасно обходя version=\"1.0\":=ПОДСТАВИТЬ(ПОДСТАВИТЬ(ПОДСТАВИТЬ(A2;\"version=\"\"1.0\"\"\";\"%version%\");\".\";\",\");\"%version%\";\"version=\"\"1.0\"\"\")(A2 содержит xml-респонс сервиса)"
    },
    {
      "id": 21537790,
      "author": "empenoso",
      "datetime": "2020-04-24T14:45:54.000Z",
      "text": "Пробовал применить функцию ПОДСТАВИТЬ до функции ФИЛЬТР.XML, но тогда замена точек на запятую приводит xml в негодное для этой функции состояние.Нарушается структура xml, если менять все точки на запятые:Оригинал:<?xml version=\"\"1.0\"\" encoding=\"\"UTF-8\"\"?>Если менять все точки на запятые:<?xml version=\"\"1,0\"\" encoding=\"\"UTF-8\"\"?>Вот решение:=ФИЛЬТР.XML( ПОДСТАВИТЬ( ПОДСТАВИТЬ(ВЕБСЛУЖБА(\"xxx\");\".\";\",\");\"1,0\";\"1.0\");\"ххх\")"
    },
    {
      "id": 21538444,
      "author": "kostarev_v",
      "datetime": "2020-04-24T17:15:18.000Z",
      "text": "Да, это сработало! Жаль только, что формула всё усложняется. Хотелось бы проще"
    },
    {
      "id": 21538544,
      "author": "empenoso",
      "datetime": "2020-04-24T17:37:22.000Z",
      "text": "Это вряд-ли — обычно только всё усложняется со временем."
    },
    {
      "id": 21558240,
      "author": "protorus",
      "datetime": "2020-04-30T05:31:55.000Z",
      "text": "а если где-то в структуре xml-ответа будет такое значение, как value=«1.05», то такой способ все сломает"
    },
    {
      "id": 21558244,
      "author": "empenoso",
      "datetime": "2020-04-30T05:32:37.000Z",
      "text": "Да, это костыль, но Вы можете предложить решение?"
    },
    {
      "id": 21558666,
      "author": "protorus",
      "datetime": "2020-04-30T07:54:21.000Z",
      "text": "Грамотного ничего, но можно костыль подправить, если совсем просто, то например так, =ФИЛЬТР.XML(ЗАМЕНИТЬ(ПОДСТАВИТЬ(ВЕБСЛУЖБА(«xxx»);\".\";\",\");17;1;\".\");«xxx»)"
    },
    {
      "id": 21558724,
      "author": "empenoso",
      "datetime": "2020-04-30T08:08:36.000Z",
      "text": "Не могу понять а 17 — это откуда?"
    },
    {
      "id": 21558758,
      "author": "protorus",
      "datetime": "2020-04-30T08:21:18.000Z",
      "text": "это позиция точки в строке<?xml version=\"1.0\" encoding=\"UTF-8\"?>"
    },
    {
      "id": 21558866,
      "author": "empenoso",
      "datetime": "2020-04-30T08:54:05.000Z",
      "text": "Более хитрый костыль :)"
    },
    {
      "id": 21594302,
      "author": "kostarev_v",
      "datetime": "2020-05-09T17:15:33.000Z",
      "text": "я просто менял =«1,0» на =«1.0»ПОДСТАВИТЬ(«XXX»;\"=\"«1,0»;\"=\"«1.0»);"
    },
    {
      "id": 23502592,
      "author": "Crypto",
      "datetime": "2021-09-20T14:48:55.000Z",
      "text": "Столкнулся с этой же проблемой и выяснил, что это результат неправильной интерепретации функцией ФИЛЬТР.XML значения как... даты.Возьмем пример значения7.95.Если просто ввести это число в ячейку Excel, то в ячейке появится текстиюл.95, а в поле редактирования будет стоять01.07.1995. Это потому, что в Excel сработал механизм автоматического \"угадывания\" формата значения, и он решил, что пользователь ввёл дату.Теперь, если поменять формат ячейки на \"Общий\" (там сначала будет стоять(все форматы)), то в поле появится... целое число34881.Именно это происходит в функции ФИЛЬТР.XML для некоторых котировок (т.е. когда сервис MOEX возвращает, например,LAST=\"7.95\"). Функция возвращает неправильно интерпретируемое значение уже в общем формате, как целое число.К сожалению, с этим целочисленным результатом ничего не получится сделать, изменение формата ячейки не помогает. Как заставить саму функцию ФИЛЬТР.XMLНЕинтерпретировать подобные значения как даты, я пока так не нашёл. Временно прикрутил \"костыль\", похожий на предложенный вами - заменяю точки на запятые в исходном xml-респонсе, безопасно обходя version=\"1.0\":=ПОДСТАВИТЬ(ПОДСТАВИТЬ(ПОДСТАВИТЬ(A2;\"version=\"\"1.0\"\"\";\"%version%\");\".\";\",\");\"%version%\";\"version=\"\"1.0\"\"\")(A2 содержит xml-респонс сервиса)"
    },
    {
      "id": 21539552,
      "author": "kostarev_v",
      "datetime": "2020-04-25T04:58:43.000Z",
      "text": "Вот ещё вопрос для размышления, может найдётся ответ когда-нибудь:Есть ли способ через API мосбиржи узнать, работает ли она сегодня… Или работала ли она в определённую дату? Ну или просто работает ли она прямо сейчас?Чтоб в выходные показывала, что не работает, и после закрытия дня тоже показывала что не работает…Если надётся ответ, отпишитесь"
    },
    {
      "id": 21542582,
      "author": "empenoso",
      "datetime": "2020-04-26T01:48:45.000Z",
      "text": "Вот в телеграм канале подсказывают:Ну я рабочие дни брал по датам индекса Мосбиржи например (из iss/history). Это конечно не совсем то, но требуемый результат получите."
    },
    {
      "id": 21677400,
      "author": "Lubiviy_Alexander",
      "datetime": "2020-05-29T22:07:45.000Z",
      "text": "Очень занимательная статья.Было бы интересно почитать похожую статью про получение финансовых прогнозов с рбк и технического анализа с investing com.Также интересно почитать как вы применяете данные знания для аналитики: позволяет ли это анализировать акции «на потоке», возможно образовались какие-нибудь удачные паттерны анализа?"
    },
    {
      "id": 21678218,
      "author": "empenoso",
      "datetime": "2020-05-30T09:21:04.000Z",
      "text": "Через пару недель опубликую статью про поиск облигаций на Мосбирже."
    },
    {
      "id": 21678222,
      "author": "empenoso",
      "datetime": "2020-05-30T09:21:51.000Z",
      "text": "И планирую написать про получение любых данных с яху финанс через API."
    },
    {
      "id": 21678226,
      "author": "empenoso",
      "datetime": "2020-05-30T09:22:57.000Z",
      "text": "Лично я применяю данные знания для учета активов. Как здесь,например."
    },
    {
      "id": 21796724,
      "author": "rick1177",
      "datetime": "2020-06-30T21:53:25.000Z",
      "text": "Подскажите, пожалуйста, при запросе бумаге вот по такому коду LSNG выводится ну что-то очень странное (цена не «цена» а что-то другое).Формула выглядит так:=ПОДСТАВИТЬ( ФИЛЬТР.XML(ВЕБСЛУЖБА(\"https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities.xml?iss.dp=comma&iss.meta=off&iss.only=securities&securities.columns=SECID,PREVADMITTEDQUOTE\");\"//document//data//rows//row[@SECID='\"&A1&\"']/@PREVADMITTEDQUOTE\");\".\";\",\")В ячейке A1 указывается LSNG"
    },
    {
      "id": 21797040,
      "author": "empenoso",
      "datetime": "2020-07-01T02:56:31.000Z",
      "text": "Ответ апи корректный:<row SECID=\"LSNG\" PREVADMITTEDQUOTE=\"6.03\"/>Формула ещё заменяет точку на запятую. А какая у вас локаль установлена?"
    },
    {
      "id": 21798224,
      "author": "rick1177",
      "datetime": "2020-07-01T10:51:22.000Z",
      "text": "Локаль стоит русская. Попробовал сменить всё на английский — не изменилась ситуация.Если подставить «GAZP» или «SBER» — всё корректно. Именно на этой бумаге почему-то не так. Причём название он её правильно определил, а в качестве цены выставил «43896». Вот файл:yadi.sk/i/dJ2I3hJRINEJBwНе могу понять где зарылся ответ."
    },
    {
      "id": 21798250,
      "author": "empenoso",
      "datetime": "2020-07-01T11:02:15.000Z",
      "text": "Возможно, что-то с форматами не так указано. На вид как будто дата. Как будто он распознаёт это число как дату."
    },
    {
      "id": 21798494,
      "author": "rick1177",
      "datetime": "2020-07-01T12:19:34.000Z",
      "text": "Именно это он и делал. Причём делал он это на этапе применения функции «ФЛЬТР.XML». На текущий момент костыльное решение выглядит так:=ПОДСТАВИТЬ(ФИЛЬТР.XML(ПОДСТАВИТЬ(ПОДСТАВИТЬ(ВЕБСЛУЖБА(\"https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities.xml?iss.dp=comma&iss.meta=off&iss.only=securities&securities.columns=SECID,PREVADMITTEDQUOTE\");\".\";\"ю\");\"ю\";\".\";1);\"//document//data//rows//row[@SECID='\"&A1&\"']/@PREVADMITTEDQUOTE\");\"ю\";\",\")*1"
    },
    {
      "id": 21820230,
      "author": "protorus",
      "datetime": "2020-07-07T13:44:15.000Z",
      "text": "у тебя порядок другой, сначала выполняется ФИЛЬТР.XML, затем ПОДСТАВИТЬ, а нужно наоборот, сначала нужно правильно заменить точки на запятые, затем уже ФИЛЬТР.XMLНапример так,A1 = LSNGA2 = ВЕБСЛУЖБА(«iss.moex.com/iss/engines/stock/markets/shares/boards/TQBR/securities.xml?iss.meta=off&iss.only=securities&securities.columns=SECID,PREVADMITTEDQUOTE»)A3 = ПОДСТАВИТЬ(A2;\".\";\",\")A4 = ЗАМЕНИТЬ(A3;17;1;\".\")A5 = ФИЛЬТР.XML(A4;\"//document//data//rows//row[@SECID='\"&A1&\"']/@PREVADMITTEDQUOTE\")"
    },
    {
      "id": 22015500,
      "author": "olegpoltoraname",
      "datetime": "2020-08-31T09:52:50.000Z",
      "text": "Недавно МосБиржа запустила торги акций иностранных эмитентов из индекса S&P 500.Но я не могу через API получит доступ к курсу бумаг.Использовал и board FQBR и другие — Мосбиржа знает о бумаге (MSFT-RM), но данные по торгам пустые. Возможно не там ищу.Если кто разбирался, подскажите, пожалуйста."
    },
    {
      "id": 22015512,
      "author": "empenoso",
      "datetime": "2020-08-31T09:55:37.000Z",
      "text": "Приведите полную ссылку — где искали?"
    },
    {
      "id": 22015638,
      "author": "olegpoltoraname",
      "datetime": "2020-08-31T10:22:47.000Z",
      "text": "Тут я узнал про board FQBR и что биржа в принципе знает о бумаге и ее тикет верный:iss.moex.com/iss/securities.xml?q=MSFT-RMИспользовал board:iss.moex.com/iss/engines/stock/markets/shares/boards/FQBR/securities.xml?но тут поля rows пустые, хотя другая информация присутствует.Для интереса прошелся по некоторым board из:iss.moex.com/iss/engines/stock/markets/sharesно в них так же поле rows пустое."
    },
    {
      "id": 22017418,
      "author": "empenoso",
      "datetime": "2020-08-31T17:41:22.000Z",
      "text": "Непонятно, да. Может быть в другой секции:iss.moex.com/iss/enginesА может быть информация доступна только по подписке.Путь вроде правильный, но там пусто:iss.moex.com/iss/engines/stock/markets/shares/boards/FQBR/securitiesДве бумаги кстати находит:iss.moex.com/iss/securities.xml?q=MSFT"
    },
    {
      "id": 22017684,
      "author": "olegpoltoraname",
      "datetime": "2020-08-31T18:35:16.000Z",
      "text": "Там почти все из топ10 S&P500 есть. Странно, что не сам топ, а выборочно.К концу года обещают 30, и каждый квартал добавлять, но без api не представляю что делать."
    },
    {
      "id": 22019026,
      "author": "empenoso",
      "datetime": "2020-09-01T04:53:03.000Z",
      "text": "Вообще, можно использовать другой апи — напримервот тоже бесплатный."
    },
    {
      "id": 22019332,
      "author": "empenoso",
      "datetime": "2020-09-01T06:55:26.000Z",
      "text": "Проглядели мы с вами. Всё у них есть в новой секции foreignshares:iss.moex.com/iss/engines/stock/markets/foreignshares/boards/FQBR/securitiesА была тут информация:iss.moex.com/iss/engines/stock/markets"
    },
    {
      "id": 22021542,
      "author": "olegpoltoraname",
      "datetime": "2020-09-01T15:10:18.000Z",
      "text": "«foreignshares»!Спасибо! Пишу коммент благодарности, т.к. не могу проголосовать за ответ."
    },
    {
      "id": 22021704,
      "author": "olegpoltoraname",
      "datetime": "2020-09-01T15:56:32.000Z",
      "text": "Странно, что api не знает об apple.В S&P500 Apple на первом месте с 7.3%В документе Мосбиржи «Презентация „Торги иностранными ценными бумагами“» apple есть —fs.moex.com/files/21231"
    },
    {
      "id": 22021726,
      "author": "empenoso",
      "datetime": "2020-09-01T16:02:26.000Z",
      "text": "Может быть по ним торги ещё не начались на Мосбирже?"
    },
    {
      "id": 22034200,
      "author": "olegpoltoraname",
      "datetime": "2020-09-04T16:06:07.000Z",
      "text": "А как подобное сделать и для СПб? Там ведь больше представлено акций иностранных компаний. У меня только недавно интерес сместился от etf к «прямым» акциям и сейчас ищу информацию об избежании двойного налогообложения и на Мосбирже и на СПб.У вас есть интерес к СПб бирже?"
    },
    {
      "id": 22034214,
      "author": "empenoso",
      "datetime": "2020-09-04T16:09:18.000Z",
      "text": "А у СПб разве есть апи?"
    },
    {
      "id": 22037148,
      "author": "olegpoltoraname",
      "datetime": "2020-09-05T16:31:16.000Z",
      "text": "что-то есть, но я не ковырял его еще."
    },
    {
      "id": 22037164,
      "author": "empenoso",
      "datetime": "2020-09-05T16:39:18.000Z",
      "text": "Ссылкой поделитесь?"
    },
    {
      "id": 22037254,
      "author": "olegpoltoraname",
      "datetime": "2020-09-05T17:20:03.000Z",
      "text": "spbexchange.ru/ru/otc_market/repository/api"
    },
    {
      "id": 22055518,
      "author": "kostarev_v",
      "datetime": "2020-09-10T12:16:25.000Z",
      "text": "искал я в своё время способ добыть цены, свечи, дивиденды по бумагам с спб биржи… Так ни чего и не нашёл… Этот апи по ссылке тоже видел, но не осилил. В итоге сделал всё на yahoo finance api. Оно вроде как не официальное и без документации, но вполне работоспособное, если покапатьсяquery1.finance.yahoo.com/v8/finance/chart/AAPL?symbol=AAPL&period1=1560193200&period2=1585150003&interval=1d&includePrePost=true&events=div%7Csplit%7Cearn&"
    },
    {
      "id": 22056614,
      "author": "empenoso",
      "datetime": "2020-09-10T16:21:41.000Z",
      "text": "Писал про него:Все финансовые рынки мира в API Яху Финанс."
    },
    {
      "id": 22056640,
      "author": "kostarev_v",
      "datetime": "2020-09-10T16:30:02.000Z",
      "text": "Точно, а я как-то проглядел. Полезная статья"
    },
    {
      "id": 25797444,
      "author": "dbax",
      "datetime": "2023-07-28T11:13:05.000Z",
      "text": "Насколько я понял ФИЛЬТР.XML использует функции операционной системы Windows, поэтому она не возвращает результаты на компьютере Mac.Увы.На линуксах вроде работает."
    }
  ]
}