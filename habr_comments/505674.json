{
  "url": "https://habr.com/ru/articles/505674/comments/",
  "article_id": 505674,
  "title": "Все финансовые рынки мира в API Яху Финанс",
  "comments": [
    {
      "id": 21714308,
      "author": "pamef",
      "datetime": "2020-06-08T13:47:58.000Z",
      "text": "Спасибо за статью, но в самом начале сформулирован вопрос, на который нет ответа в целой большой и полезной статье.официальное API Яху Финанс было закрыто три года назад, однако практически сразу же появилась его недокументированная работоспособная версия, которая жива до сих пор.Вопрос: что конспирологи и другие исследователи этого мира думают по поводу такого артефакта? Кто платит за этот банкет со стороны Яху и зачем они это делают?И т.п."
    },
    {
      "id": 21714320,
      "author": "empenoso",
      "datetime": "2020-06-08T13:51:23.000Z",
      "text": "Скорее всего это баг — то что им можно пользоваться."
    },
    {
      "id": 21714744,
      "author": "pamef",
      "datetime": "2020-06-08T15:27:43.000Z",
      "text": "Баг — это дыра, а вот платить 3+ года за поддержку офиц. закрытого — это не баг, а фича. Но заради чего или кого, Холмс?"
    },
    {
      "id": 21722294,
      "author": "OnvogSGN",
      "datetime": "2020-06-10T08:03:07.000Z",
      "text": "Вряд ли там какая-то поддержка в полном смысле слова. Скорее, оставили и больше не трогали. Это ж Яху, оно всегда так работало :) А может, оставили ради немногочисленных действующих клиентов, чтобы не ломать им процессы."
    },
    {
      "id": 21714316,
      "author": "n1k_ivanov",
      "datetime": "2020-06-08T13:50:48.000Z",
      "text": "Так же советую посмотреть тиньков инвестиции API. Тоже интересно, можно делать даже торговые боты с управление в ТГ (как пример)."
    },
    {
      "id": 21714330,
      "author": "empenoso",
      "datetime": "2020-06-08T13:53:25.000Z",
      "text": "Это другая тема конечно. Среди российских брокеров наверное по пальцам одной руки можно пересчитать кто имеет своё API. И Тинькофф банк один из них."
    },
    {
      "id": 21714510,
      "author": "empenoso",
      "datetime": "2020-06-08T14:38:57.000Z",
      "text": "Вот обсуждение было:habr.com/ru/post/496722/#comment_21491254"
    },
    {
      "id": 21721234,
      "author": "OnvogSGN",
      "datetime": "2020-06-09T22:21:35.000Z",
      "text": "Не могу ответить там. Альфа-директ имеет своё API задолго до появления Тинькова"
    },
    {
      "id": 21721476,
      "author": "empenoso",
      "datetime": "2020-06-10T02:07:26.000Z",
      "text": "Вы имеете в виду для отчетов или что-то другое?"
    },
    {
      "id": 21722246,
      "author": "OnvogSGN",
      "datetime": "2020-06-10T07:54:19.000Z",
      "text": "Для всех операций, которые можно делать через терминал. В том числе, для подачи заявок."
    },
    {
      "id": 21722312,
      "author": "empenoso",
      "datetime": "2020-06-10T08:05:37.000Z",
      "text": "Подскажите, а где подробнее можно про это почитать?"
    },
    {
      "id": 21722428,
      "author": "OnvogSGN",
      "datetime": "2020-06-10T08:33:12.000Z",
      "text": "А вот это сложный вопрос :))) Вроде, оно закопано где-то в глубинах их сайта. Это частый вопрос новичков в чате АД. Но текущей 4-й версией API я уже не интересовался и документацию не видел. Ну и в текущей версии они делают больше упор на программирование роботов и индикаторов внутри самого терминала, на каком-то C#-подобном языке."
    },
    {
      "id": 21723004,
      "author": "empenoso",
      "datetime": "2020-06-10T10:39:37.000Z",
      "text": "А собственные позиции только в режиме чтения можно через апи в Альфа Директе получать?"
    },
    {
      "id": 21723078,
      "author": "OnvogSGN",
      "datetime": "2020-06-10T11:05:51.000Z",
      "text": "Опять же — документацию к текущей версии не видел, но уверен, что да. Это ж элементарная операция и в то же время, одна из важнейших.Точно знаю, что у StockSharp есть коннектор через это API. А уж это полноценная торговая система, соответственно, все эти возможности в API АД есть."
    },
    {
      "id": 21715460,
      "author": "vrangel",
      "datetime": "2020-06-08T19:10:21.000Z",
      "text": "Спасибо за статью.Вопрос: Есть ли какие-нибудь ограничения на количество запросов? Если я, скажем, захочу сделать анализ всех акций сектора и запрошу параллельно несколько тысяч параметров?Я где-то встречал информацию, что этот API выдает агрегированную информацию за 15 (???) минут."
    },
    {
      "id": 21716254,
      "author": "empenoso",
      "datetime": "2020-06-09T02:11:25.000Z",
      "text": "Никаких специальных тестов я не проводил. Но на глаз несколько десятков запросов за минуту вполне работает."
    },
    {
      "id": 21717568,
      "author": "stepmex",
      "datetime": "2020-06-09T09:08:34.000Z",
      "text": "А запрос на получение списка всех ценных бумаг (symbols) есть?"
    },
    {
      "id": 21718356,
      "author": "empenoso",
      "datetime": "2020-06-09T11:07:58.000Z",
      "text": "Мне о таком неизвестно."
    },
    {
      "id": 21768830,
      "author": "postgres",
      "datetime": "2020-06-23T22:51:13.000Z",
      "text": "я находил такой инструмент, который перебором бешеное количество выкачиваетpypi.org/project/Yahoo-ticker-downloaderПонял, что проще брать то, что нужно (торгуется у брокера)"
    },
    {
      "id": 21769022,
      "author": "empenoso",
      "datetime": "2020-06-24T02:06:10.000Z",
      "text": "Спасибо!"
    },
    {
      "id": 21769074,
      "author": "empenoso",
      "datetime": "2020-06-24T03:17:51.000Z",
      "text": "Похоже в настоящий момент он устарел, потому что в коде используется отключенное АПИ."
    },
    {
      "id": 21774232,
      "author": "postgres",
      "datetime": "2020-06-25T06:55:31.000Z",
      "text": "Но при этом работаетstart> python3 YahooTickerDownloader.py\nChecking if we can resume a old download session\nNo old downloader found on disk\nStarting a new session\nDownloading generic\n\nreq https://finance.yahoo.com/_finance_doubledown/api/resource/searchassist;searchTerm=b?device=console&returnMeta=true\nGot 10 downloaded generic symbols:\n Generic B NYQ Barnes Group Inc.\n Generic BA NYQ The Boeing Company\n  ect...\nProgress: Query 2/64.\n10 unique generic entries collected so far.\n\nreq https://finance.yahoo.com/_finance_doubledown/api/resource/searchassist;searchTerm=c?device=console&returnMeta=true\nGot 9 downloaded generic symbols:\n Generic C NYQ Citigroup Inc.\n Generic CALT NMS Calliditas Therapeutics AB (publ)\n  ect...\nProgress: Query 3/64.\n19 unique generic entries collected so far.\n\nreq https://finance.yahoo.com/_finance_doubledown/api/resource/searchassist;searchTerm=d?device=console&returnMeta=true\nGot 10 downloaded generic symbols:\n Generic D NYQ Dominion Energy, Inc.\n Generic DADA NMS Dada Nexus Limited\n  ect...\nProgress: Query 4/102.\n29 unique generic entries collected so far.\n\n................................"
    },
    {
      "id": 21774394,
      "author": "empenoso",
      "datetime": "2020-06-25T07:25:03.000Z",
      "text": "Спасибо, очень полезно. С python не особо знаком, на node.js переделаю.Скрипт получается перебирает просто буквы алфавита? Но при этом в выборку попадает только американский рынок?Например простобуква g— но в результатах нет gazp.me например, однако если запросgazp, то эта российская бумага уже в выборке."
    },
    {
      "id": 21774500,
      "author": "postgres",
      "datetime": "2020-06-25T07:44:58.000Z",
      "text": "Я особо не вникал, оставил на ночь, и он собрал мне150к строк, и там нет газпрома)видимо возьмет его лишь когда дойдет доgazp.meПоэтому такой перебор мне не понравился) Может там есть какие-то параметры… но я подумал, что иду не по тому пути)finance.yahoo.com/_finance_doubledown/api/resource/searchassist;searchTerm=gazp.me?device=console&returnMeta=true"
    },
    {
      "id": 21774630,
      "author": "empenoso",
      "datetime": "2020-06-25T08:08:57.000Z",
      "text": "Вот скрипт выборки всех бумаг с nasdaq — прямо с их ftp:#!/bin/bash\n\necho -n '[\"' > stocks.json\ncurl -o nasdaq.txt ftp://ftp.nasdaqtrader.com/symboldirectory/nasdaqtraded.txt\ncat nasdaq.txt | grep -Eo '^\\w\\|\\w*' | sed 's/^\\w|//g' | sed 'H;1h;$!d;x;y/\\n/,/' | sed 's/,/\\\",\\\"/g' >> stocks.json\necho '\"]' >> stocks.json\nsed -i ':a;N;$!ba;s/\\n//' stocks.json\nrm nasdaq.txt"
    },
    {
      "id": 21774638,
      "author": "empenoso",
      "datetime": "2020-06-25T08:11:57.000Z",
      "text": "Скрипт на каждой итерации получается добавляет +1 букву?буквабуква+буквабуква+буква+буква…"
    },
    {
      "id": 21774666,
      "author": "postgres",
      "datetime": "2020-06-25T08:16:46.000Z",
      "text": "ага(еще точку, цифры, %Возможно там чуть умнее перебор, и не возможные комбинации этого дела собираются, но все равно очень долго и много)"
    },
    {
      "id": 21790028,
      "author": "empenoso",
      "datetime": "2020-06-29T11:35:46.000Z",
      "text": "Кстати, если вы ищите просто общий список акций с мосбиржи, товот он. Можно перебирать ещегруппы."
    },
    {
      "id": 21869114,
      "author": "empenoso",
      "datetime": "2020-07-20T18:20:17.000Z",
      "text": "А можете последовательность как он перебирает символы сбросить?"
    },
    {
      "id": 21731230,
      "author": "mrShadow",
      "datetime": "2020-06-12T11:22:27.000Z",
      "text": "Занятно, что Yahoo.Finance выдаёт Sector и Industry для компаний, торгующихся только в России, тоже. Например:query1.finance.yahoo.com/v10/finance/quoteSummary/OBUV.ME?modules=assetProfileindustry: \"Footwear & Accessories\",sector: \"Consumer Cyclical\","
    },
    {
      "id": 21731414,
      "author": "empenoso",
      "datetime": "2020-06-12T12:18:55.000Z",
      "text": "Да, но только для акций. Очень удобно кстати."
    },
    {
      "id": 21731268,
      "author": "mrShadow",
      "datetime": "2020-06-12T11:39:12.000Z",
      "text": "Вообще получение истории цен это супер возможность, спасибо! А то у меня функция GOOGLEFINANCE в Google Spreadsheets периодически глючит, либо начиная выдавать ошибку N/A, либо зависая в Loading… Может, перейду на использование скриптов (Google App Scripts), откуда буду дёргать Yahoo.Finance.Жаль конечно, что информации о российских облигациях в Yahoo.Finance, видимо, нет, так же как в GOOGLEFINANCE. Остаёмся на API Московской биржи."
    },
    {
      "id": 21731422,
      "author": "empenoso",
      "datetime": "2020-06-12T12:21:11.000Z",
      "text": "Там нет и американских облигаций, и европейских. С получаем параметров облигаций вообще не очень радужная ситуация."
    },
    {
      "id": 21768822,
      "author": "postgres",
      "datetime": "2020-06-23T22:45:37.000Z",
      "text": "Где вы раньше были)не так давно требовалось скачать историю акций которые есть в Тинькофф, случайно наткнулся на Yahoo.Заметил, что по российским акциям можно лишь к тикеру.MEприлепитьсгенерил для bash такой скрипт скачивания csv (да, можно было бы и цикл на тикер для красоты)only_rus.shPERIOD_FROM=`date -d '01/01/2015 00:00:00' +\"%s\"` # mm/dd/yy\nPERIOD_TO=`date -d '01/01/2030 00:00:00' +\"%s\"` # mm/dd/yy\nINTERVAL=1d\nSLEEP_SECONDS=1.1\n curl -s \"https://query1.finance.yahoo.com/v7/finance/download/ABRD.ME?period1=$PERIOD_FROM&period2=$PERIOD_TO&interval=$INTERVAL&events=history\" -o ABRD.ME.csv && date && echo \"     1 / 122 -  ABRD.ME\" &&\nsleep $SLEEP_SECONDS\n curl -s \"https://query1.finance.yahoo.com/v7/finance/download/AFKS.ME?period1=$PERIOD_FROM&period2=$PERIOD_TO&interval=$INTERVAL&events=history\" -o AFKS.ME.csv && date && echo \"     2 / 122 -  AFKS.ME\" &&\nsleep $SLEEP_SECONDS\n curl -s \"https://query1.finance.yahoo.com/v7/finance/download/AFLT.ME?period1=$PERIOD_FROM&period2=$PERIOD_TO&interval=$INTERVAL&events=history\" -o AFLT.ME.csv && date && echo \"     3 / 122 -  AFLT.ME\" &&\nsleep $SLEEP_SECONDS\n#и т.д.Заметил, что:— все же нужна задержка, т.к. запросы повисали наглухо, и как будто банился ip на время— иногда странные данные, типа 0-е объемы, хотя бумага явно торговалась в этот день, или цена в какие-то дни якобы падала раз в 10. Но по данным другим источников такого не былоприм.: посмотрите график за 5 летfinance.yahoo.com/quote/BANEP.ME— не показывается данные текущего дня по «американским» акциям, до начала захода Америки, хотя мы уже вовсю торгуем ими. Или я не туда смотрю?"
    },
    {
      "id": 21769036,
      "author": "empenoso",
      "datetime": "2020-06-24T02:26:24.000Z",
      "text": "Вотссылка с запросомна Мосбиржу."
    },
    {
      "id": 21769024,
      "author": "empenoso",
      "datetime": "2020-06-24T02:08:55.000Z",
      "text": "Вообще, оптимальнее воспользоваться апи Московской биржи для этой задачи."
    },
    {
      "id": 22703700,
      "author": "Khort",
      "datetime": "2021-02-19T08:04:22.000Z",
      "text": "Очень полезная статья, спасибо! Забил основные метрики с яху финас в ibreoffice calc, работает нормально.Однако, есть претензии к самому яхуфинанс — цифры зачастую не совпадают с информацией с других сайтов, и/или помечена как полученная из сторонних источников различными неназванными методиками. Другими словами, зачастую на яху финанс лежит неверная информация. Отсюда вопросА что есть еще, бесплатное, по американским акциям, в формате XML/JSON?парсить html — не вариант, очень быстро банят айпи, буквально 500-1000 запросов, и все."
    },
    {
      "id": 22715382,
      "author": "empenoso",
      "datetime": "2021-02-22T06:54:05.000Z",
      "text": "Прямо бесплатно не так много вариантов."
    },
    {
      "id": 22715668,
      "author": "Khort",
      "datetime": "2021-02-22T08:36:03.000Z",
      "text": "Дайте хотя бы один такой бесплатный вариант, если не сложно.Пока самое полезное что я нашел, это alpha vantage, там доступны вся база данных, но совершенно конские ограничения на число запросов (5 в минуту, 500 в день, если не путаю) — использую только чтобы дополнить или проверить отдельные поля с яхуу.Еще, вроде бы пишут, что гугл финас до сих пор както работает, но я не нашел их базы данных."
    },
    {
      "id": 22716392,
      "author": "empenoso",
      "datetime": "2021-02-22T11:21:42.000Z",
      "text": "finnhub.io/docs/apiiexcloud.io/docs/apiexchangeratesapi.ioВ прошлых моих статьях было обсуждение в комментариях — надо там поискать."
    }
  ]
}